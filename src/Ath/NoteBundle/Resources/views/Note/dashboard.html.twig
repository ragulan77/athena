{% extends "::base.html.twig" %}
{% block title %}Note{% endblock title%}
{% block styles %}
<style>
.table-bordered {
border: 1px solid #dddddd;
border-collapse: separate;
border-left: 0;
-webkit-border-radius: 4px;
-moz-border-radius: 4px;
border-radius: 4px;
}

.table {
width: 100%;
margin-bottom: 20px;
background-color: transparent;
border-collapse: collapse;
border-spacing: 0;
display: table;
}

.widget.widget-table .table {
margin-bottom: 0;
border: none;
}

.widget.widget-table .widget-content {
padding: 0;
}

.widget .widget-header + .widget-content {
border-top: none;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
-moz-border-radius-topleft: 0;
-moz-border-radius-topright: 0;
border-top-left-radius: 0;
border-top-right-radius: 0;
}

.widget .widget-content {
padding: 20px 15px 15px;
background: #FFF;
border: 1px solid #D5D5D5;
-moz-border-radius: 5px;
-webkit-border-radius: 5px;
border-radius: 5px;
}

.widget .widget-header {
position: relative;
height: 40px;
line-height: 40px;
background: #E9E9E9;
background: -moz-linear-gradient(top, #fafafa 0%, #e9e9e9 100%);
background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #fafafa), color-stop(100%, #e9e9e9));
background: -webkit-linear-gradient(top, #fafafa 0%, #e9e9e9 100%);
background: -o-linear-gradient(top, #fafafa 0%, #e9e9e9 100%);
background: -ms-linear-gradient(top, #fafafa 0%, #e9e9e9 100%);
background: linear-gradient(top, #fafafa 0%, #e9e9e9 100%);
text-shadow: 0 1px 0 #fff;
border-radius: 5px 5px 0 0;
box-shadow: 0 2px 5px rgba(0,0,0,0.1),inset 0 1px 0 white,inset 0 -1px 0 rgba(255,255,255,0.7);
border-bottom: 1px solid #bababa;
filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#FAFAFA', endColorstr='#E9E9E9');
-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='#FAFAFA', endColorstr='#E9E9E9')";
border: 1px solid #D5D5D5;
-webkit-border-top-left-radius: 4px;
-webkit-border-top-right-radius: 4px;
-moz-border-radius-topleft: 4px;
-moz-border-radius-topright: 4px;
border-top-left-radius: 4px;
border-top-right-radius: 4px;
-webkit-background-clip: padding-box;
}

thead {
display: table-header-group;
vertical-align: middle;
border-color: inherit;
}

.widget .widget-header h3 {
top: 2px;
position: relative;
left: 10px;
display: inline-block;
margin-right: 3em;
font-size: 14px;
font-weight: 600;
color: #555;
line-height: 18px;
text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
}

.widget .widget-header [class^="icon-"], .widget .widget-header [class*=" icon-"] {
display: inline-block;
margin-left: 13px;
margin-right: -2px;
font-size: 16px;
color: #555;
vertical-align: middle;
}
</style>
{% endblock styles %}


{% block javascripts %}
<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
{% endblock javascripts %}

{% block footer_js %}
<script type="text/javascript">
$('#classeOptions').on('change',function() {
		var id = this.value
		var generatedUrl = Routing.generate('ath_note_getMatieres',{ classeId: id });
        $.ajax({
            type: "POST",
            url: generatedUrl,
            data: $(this).serialize(),
            cache: false,
            dataType : 'JSON',
            success: function(data){

                var disciplineOptions = $("#disciplineOptions");

                for (var i = 0; i < data["disciplines"].length; i++) {
                	//alert(data["disciplines"][i].name);
                    disciplineOptions.append($("<option />").val(data["disciplines"][i].id).text(data["disciplines"][i].name));
                }

                var studentTable = $("#studentsTable");
  				studentTable.empty();
  				if(data["students"].length > 0){
	  				for (var i = 0; i < data["students"].length; i++) {
		 				studentTable.append($("<tr>")
		 		 				.append($("<td>").text(data["students"][i].firstname))
		 						.append($("<td>").text(data["students"][i].lastname))
		 						.append($("<td>").text(data["students"][i].classe))
		 						.append($("<td>")
		 							.append($('<input/>').attr({
			 							 type: 'radio',
			 							 id:'studentChoice',
			 							 name:'studentChoice',
			 							 value: data["students"][i].id
				 					}))
								)
		 			 	);
	  				}
  				}else{
  					studentTable.append($("<tr>")
	 		 				.append($("<td>").text("N/A"))
	 						.append($("<td>").text("N/A"))
	 						.append($("<td>").text("N/A"))
	 						.append($("<td>").text("N/A"))
	 				);
  	  	  		}
            },error: function(){
            	 var studentTable = $("#studentsTable");
   				 studentTable.empty();
   				 studentTable.append($("<tr>")
 		 				.append($("<td>").text("N/A"))
 						.append($("<td>").text("N/A"))
 						.append($("<td>").text("N/A"))
 						.append($("<td>").text("N/A"))
 				 );
            },
            beforeSend: function(){
           		var disciplineOptions = $("#disciplineOptions");
 				disciplineOptions.empty();
 				disciplineOptions.append($("<option />").text("-------"));
            }
        });
        return false;
});

$('#editNoteStudentForm').submit(function(e) {
	var idMatiere = $('#disciplineOptions').find(":selected").val();
	var idEtudiant= $('input[name=studentChoice]:checked', '#editNoteStudentForm').val()
	if (idMatiere != "-------"){
		var generatedUrl = Routing.generate('ath_note_student_show',{idMatiere: idMatiere,idEtudiant: idEtudiant});
		$('#editNoteStudentForm').attr('action',generatedUrl);
	}
});
</script>
{% endblock footer_js %}

{% block breadcrumb %}
 <ol class="breadcrumb">
 <li class="active"><a href="#">Home</a></li>
  <li>Note</li>
</ol>
{% endblock breadcrumb %}

{% block mainContainer %}
<hr>
<div class="panel panel-info">
	<div class="panel-heading">Sélectionnez un étudiant et une matière</div>
	<div class="panel-body">
		<form action="#" method="post" id="editNoteStudentForm">
			<br>
			<div class="row">
				<div class="col-sm-6">
					<!-- widget -->
				    <div class="widget stacked widget-table action-table">
						<div class="widget-header">
							<span class="glyphicon glyphicon-th-list"></span>
							<h3>Table</h3>
						</div> <!-- /widget-header -->

						<div class="widget-content">
							<table class="table table-striped table-bordered">
								<thead>
									<tr>
										<th>Nom</th>
										<th>Prénom</th>
										<th>Classe</th>
										<th class="td-actions">Choix</th>
									</tr>
								</thead>
								<tbody id="studentsTable">
									<tr>
										<td>N/A</td>
										<td>N/A</td>
										<td>N/A</td>
										<td>N/A</td>
									</tr>
								</tbody>
							</table>
						</div> <!-- /widget-content -->
					</div> <!-- /widget -->
			    </div>
			    <div class="col-sm-4">
			    	<div class="row">
						<label for="classeOptions">Classe</label>
						<select id="classeOptions" name="classeOptions" class="form-control" rows=2>
							{% for classe in listeClasses %}
								{% if loop.first %}
									<option>-------</option>
									<option value={{ classe.id }}>{{ classe }}</option>
								{% else %}
									<option value={{ classe.id }}>{{ classe }}</option>
								{% endif %}
							{% endfor %}
						</select>
	             	</div>
	             	<div class="row">
	             		<label for="disciplineOptions">Matière</label>
						<select id="disciplineOptions" name="disciplineOptions" class="form-control" rows=2>
							<option>-------</option>
						</select>
	             	</div>
	             	<br>
	             	<div class="row">
	             	 <button type="submit" class="btn btn-primary">Sélectionner</button>
	             	</div>
			    </div>
	    	</div>
		</form>
	</div>
</div>
{% endblock mainContainer %}





